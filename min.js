var e,o,t,r,a,s,n,i,l,d,m,c,g,h,p,v,y,u,f,w,b,S,x,j,L,M,T,k,C,B,X,D,$,z,H=this,I=document,K="World of Emojis",W={mons:[]},Y=1,P=1,F=100,R=1,G=0,N=0,A=0,E=9,O=1,Z=[],_=[],U=[],q=1,J=Math.PI,Q=1,V=1,ee=1,oe=1,te=1,re=0,ae=[],se=[{emoji:"üê°",offsetY:1,name:"Pufferfish",types:["poison","water"],pow:"7‚ò†",hp:50},{emoji:"ü¶£",name:"Mammoth",types:["beast","ice"],pow:"11‚ùÑ",hp:80,reload:1.4,repel:.8},{emoji:"üêì",name:"Rooster",types:["bird","ground"],pow:6,hp:40,reload:.5,repel:1.2},{emoji:"üêá",name:"Rabbit",types:["ground"],pow:4,hp:30,reload:.5},{emoji:"üêø",name:"Squirrel",types:["ground"],pow:5,hp:20},{emoji:"ü¶ó",name:"Cricket",types:["bug"],pow:2,hp:15},{emoji:"üêÄ",name:"Rat",types:["poison","ground"],pow:"2‚ò†",hp:4},{emoji:"üêå",name:"Snail",types:["ground","bug"],pow:2,hp:70,reload:1.5},{emoji:"ü¶®",name:"Skunk",types:["poison","ground"],pow:"4‚ò†",hp:50,repel:.6},{emoji:"ü¶Ç",name:"Scorpion",types:["poison","fire"],pow:"7‚ò†",hp:40,reload:1.2},{emoji:"ü¶õ",name:"Hippo",types:["water","ground"],pow:15,hp:70},{emoji:"ü¶ò",name:"Kangaroo",types:["beast"],pow:8,hp:40,reload:.7},{emoji:"üêè",name:"Ram",types:["beast","metal"],pow:15,hp:70,reload:1.7},{emoji:"ü¶≠",name:"Seal",types:["water","ice"],pow:"5‚ùÑ",hp:50},{emoji:"ü¶Ü",name:"Duck",types:["water","bird"],pow:5,hp:20},{emoji:"üêä",name:"Crocodile",types:["water"],pow:15,hp:60},{emoji:"üêç",name:"Snake",types:["poison"],pow:11,hp:40},{emoji:"üê¢",name:"Turtle",types:["water"],pow:5,hp:60},{emoji:"ü¶ñ",name:"T-Rex",types:["reptile"],pow:30,hp:200,repel:.5},{emoji:"üêâ",name:"Dragon",types:["fire"],pow:25,hp:230},this.gMonKindCure={emoji:"‚ù§",name:"Heart",types:["item"],pow:1,hp:10,flip:1},{emoji:"ü©π",name:"Bandage",types:["item"],pow:2,hp:7},e={emoji:"üì¶",name:"Package",types:["item"],pow:1,hp:10}],ne=e=>{e.div.remove(),e.shadowDiv?.remove(),e.hpObj&&ne(e.hpObj)},ie=e=>{var o=30-e.reloadMax/5;to(e.hS||=oo([o,o,e.monKind.pow/100,.02,.02]))},le=e=>e.monKind.pow*(so(.6)+.7)|0,de=(e,o)=>{o<0&&(o=0),o&&!e.hp&&be(e.div,"dead"),!o&&e.hp&&(be(e.div,"dead",1),to($)),e.hp=o;var t=e.hp/e.hpMax;e.hpDiv?(e.hpDiv.innerHTML=0|o,e.hpBarDiv.style.width=100*t+"%",e.hpBarDiv.style.background=`rgb(${255*(1-t)|0},${255*t|0},0)`):e.div.lastChild.lastChild.lastChild.lastChild.style.width=100*(1-t)+"%"},me=e=>{gButR.style.display=gButL.style.display="block",ze(S.cameraY),$e(S.cameraZ),I.body.classList.remove("zoom"),I.body.classList.remove("zoom2"),a=0,Be(1),Le(-.001),ho(S.song,2),qe(),Ce(o+1)},ce=e=>{for(var o of W.mons)if(o.hp){n=o;break}Be(11),n||(I.body.style.filter="grayscale(1)",gDead.style.display="flex",Be(16))},ge=e=>{var o=he(e,0,0,55,4-(e==gMonKindCure),0,0,4);return W.mons.push(o),setTimeout(je,44),to(k),S&&qe(),o},he=(e,o,t,r,a,s,n,i,l,d)=>{var m;n||(n=.07),e.name&&(m=e,e=e.emoji);var c={emoji:e,x:o,y:t,z:r,sizeY:a,offsetY:n,kind:i,monKind:m,speech:l,scene:S,sceneGo:d,shadowNo:s};(l||d)&&ae.push(c),l&&(c.onPress=e=>{ue(c)},c.onLeave=ye),d&&(c.onPress=e=>{ze(d.cameraY),$e(d.cameraZ),te=b,Be(2),W.div.style.transition="translate .4s ease",S==gSceneWorld||d==gSceneBedroom?W.div.style.translate="0 0 -5rem":S==gSceneBedroom?W.div.style.translate="0 1rem 2rem":W.div.style.translate="-2rem 0 2rem",to(B),setTimeout((e=>{De(d)}),200)}),c.div=I.createElement("div"),c.div.className="obj obj"+S.i+(r>55?" near":"")+(4==i?" mon":"")+(2==i?" zombie":""),(u=c.div.style).fontSize=u.height=a+"rem",u.zIndex=r+(3==s?0:2e3)|0;var g=e;i&&(g=`<div><div class=flipper><div class=walker>${e}${4==i?`<div style="position:absolute;top:0;width:0;overflow:hidden" class="zombie">${e}</div>`:""}</div></div></div>`);c.div.innerHTML=g;var h=r>1?gLayer2:gLayer1;if(!s||2==s){c.shadowDiv=I.createElement("div"),c.shadowDiv.className="shadow0 obj obj"+S.i+(r>55?" near":"")+(4==i?" mon":""),(f=c.shadowDiv.style).fontSize=f.height=a+"rem",f.zIndex=100+~~r;g=i?"<div><div class=shadow"+(2==s?"OnWall":"")+"><div class=flipper><div class=walker>"+e+"</div></div></div></div>":`<div class=shadow${2==s?"OnWall":""}>${e}</div>`,c.shadowDiv.innerHTML=g,h.appendChild(c.shadowDiv)}return h.appendChild(c.div),ve(c),m&&(10==b&&(e=>{var o=W.mons.includes(e)?-3:6,t=e.hpObj=he("<div style='width:3.5rem;height:.5rem;background:#000;margin:.05rem;position:relative'><div style='height:100%'></div></div>‚ù§<span style='font-family:comic sans ms'></span>",R+o,1,55,1.6,1);e.hpDiv=t.div.lastChild,e.hpBarDiv=t.div.firstChild.firstChild})(c),de(c,c.hpMax=m.hp),c.reloadMax=50*m.reload,c.reload=5),c},pe=(e,o)=>{e.z=o,e.div.style.zIndex=2e3+~~o},ve=e=>{var o,t=e.x,r=e.y,a=e.z,s=r+4*e.offsetY,n=e.div.style,i=e.shadowDiv?.style;a>1?(r+=53,s+=53,1==e.kind?(n.transform=`translate3d(calc(var(--youX) - var(--cameraX) - 3.5rem),calc(${s}rem - 100%),${a}rem)`,o=`translate3d(calc(var(--youX) - var(--cameraX) - 3.5rem),calc(${r}rem - 100%),${a}rem)`):4==e.kind?(n.transform=`translate3d(calc(var(--youX) + ${t}rem - var(--cameraX)),calc(${s}rem - 100%),${a}rem)`,o=`translate3d(calc(var(--youX) + ${t}rem - var(--cameraX)),calc(${r}rem - 100%),${a}rem)`):(n.transform=`translate3d(calc(${t}rem - var(--cameraX)),calc(${s}rem - 100%),${a}rem)`,o=`translate3d(calc(${t}rem - var(--cameraX)),calc(${r}rem - 100%),${a}rem)`,3==e.shadowNo&&(n.transform+="rotateX(90deg)"),4==e.shadowNo&&(n.transform+="rotateY(90deg)"))):(n.transform=`translate3d(${t}rem,${s}rem,${a}rem)`,o=`translate3d(${t}rem,${r}rem,${a}rem)`),i&&(i.transform=o)},ye=e=>{L&&to(X),gSpeech.style.opacity=0,gSpeech.firstChild.style.transform="scale(0)",L=0,j&&setTimeout(j,300),1!=b&&(gButGo.style.display="none")},ue=(e,o,t)=>{var r=o||e.speech,a=1.9;r.length>45&&(a/=1+(r.length-45)/99),gSpeechText.style.fontSize=a+"rem",gSpeechText.innerHTML=r,e==W&&(W.x=R-50);var s=e.x-12.5+(W.mons.includes(e)?R:0),n=R-((e==W?0:23)+ee/100/10)*F/100,i=e.x<Y+50;i&&(s+=14),s<n&&(s=n),gSpeech.style.opacity=1,gSpeech.firstChild.firstChild.style.transform=`scaleX(${i?-1:1})`,gSpeech.firstChild.style.transformOrigin=(i?0:100)+"% 100%",gSpeech.firstChild.style.transform="scale("+(F>99?1:.7)+")",gSpeech.style.transform=`translate3d(calc(${s}rem - var(--cameraX)),calc(${e.y+55-e.sizeY}rem - 100%),`+(e.z+1)+"rem)",gSpeech.style.zIndex=2001+~~e.z,(L=e).talkTime=w,j=t,q&&4!=b&&setTimeout((e=>gButGo.style.display="block"),400),to(C)},fe=(e,o)=>{be(e.div,"walking",o),be(e.shadowDiv,"walking",o)},we=(e,o)=>{e.going=1,e.x+=o;var t,r=o>=0;return e.goRight!=r&&(e.goRight=r,t=1,be(e.shadowDiv,"flipped",r),be(e.div,"flipped",r)),e!=W&&ve(e),t},be=(e,o,t)=>{t?e.classList.add(o):e.classList.remove(o)},Se=e=>{var o=4;return W.mons.length>ee/33&&(o/=W.mons.length/(ee/33)),e*-o*(W.goRight?1:-1)-2},xe=(e,o)=>{e.div.style.transitionDuration=e.shadowDiv.style.transitionDuration=o+"s"},je=e=>{var o=1;for(var t of W.mons){if(t!=v){be(t.div,"flipped",W.goRight==!t.monKind?.flip),be(t.shadowDiv,"flipped",W.goRight==!t.monKind?.flip);var r=t.x;t.x=Se(o);var a=Oe(r-t.x);xe(t,a/20),ve(t)}o++}},Le=e=>{L&&W.mons.includes(L)&&ye(),we(W,e)&&je(),R+=1*e;var o=S.startX||4;1==b&&S==gSceneLab&&l.x<888&&!W.mons[0]&&(o=20),R>S.endX?R=S.endX:R<o&&(R=o),o-=ee/2*.7;var t=Math.max(o,S.endX-ee/2*1.23-(F-80)/2);(Y=R-ee/2)>t?Y=t:Y<o&&(Y=o);var r,n=R;if(1==b){for(var i of ae)i.scene==S&&n>i.x-1&&n<i.x+i.sizeY+1&&(r=i);if(x!=r){if(x){var d=x.div;x.kind&&(d=d.firstChild),d.style.filter="unset",L!=x&&L!=W||x.onLeave?.()}if(x=r){d=x.div;x.kind&&(d=d.firstChild),d.style.filter="brightness(1.1) contrast(1.2) drop-shadow(0 0 .5rem #9F0)"}q&&(gButGo.style.display=x?"block":"none")}}if(N>-4&&(m=(R-2)/5|0)!=c){c=m;var g=S.grass[m];g&&(to(z),g.div.firstChild.classList.add("sway"),g.shadowDiv.firstChild.firstChild.classList.add("sway"),setTimeout((e=>{g.div.firstChild.classList.remove("sway"),g.shadowDiv.firstChild.firstChild.classList.remove("sway")}),501),W.mons[0]||1!=b?so(1)<.15*W.mons[0].monKind.repel&&(e=>{Le(.001),gButR.style.display=gButL.style.display="none",Be(10),I.body.style.filter="brightness(1.5)",ze(42),$e(72),I.body.classList.add("zoom"),setTimeout((e=>I.body.classList.add("zoom2")),501),setTimeout((e=>I.body.style.filter="none"),101);var o=3,t=Oe(E-12)<7,r=se.length;R<444&&so(1)<.5&&(o=t?4:5,so()<.02&&(o=6)),S==gSceneForest&&(o=0|so(r-5),so()<.01&&(o=t?r-5:r-4));var n=se[o],i=a=he(n,R+6,.4,55,4,0,.05,2);xe(i,.5),s=W.mons[0],setTimeout((e=>{var o=W.mons[0];xe(o,.5),ue(W,`Zombie ${n.name} appeared!`,(e=>{for(var t of(o.x+=3.2,W.mons))t.x+=4,ve(t);ue(W,`Go ${o.monKind.name}!`,(e=>{xe(o,.1),Be(11)})),ho(mo,2)})),to(D)}),500)})():(Be(5),we(l,100-l.x),Xe(l,S),l.div.style.transition=l.shadowDiv.style.transition="all 1s ease",setTimeout((e=>{we(l,25),setTimeout((e=>{ue(l,"Hey! Wait! Don't go out!",(e=>{we(l,10),setTimeout((e=>{ue(l,"It's unsafe! Zombie emojis live in tall grass!",(e=>{ue(l,"You need your own emojis for your protection. I know! Here, come with me!",(e=>{Be(7)}))}))}),999)}))}),999)}),33)))}gLayer2.style.setProperty("--youX",R+"rem"),gLayer2.style.setProperty("--cameraX",Y+"rem"),S==gSceneLab&&(R>l.x+4?we(l,.001):we(l,-.001))},Me=e=>{var o=0,t=0;e||=E,S!=gSceneWorld&&S!=gSceneForest&&(e=14),e>5&&e<=19&&(o=130*(.5-(e-5)/14),t=1,e<=6&&(t=e-6),e>18&&(t=19-e)),e>=20&&(o=65-13*(e-20),t=1,e<21&&(t=e-20)),e<=5&&(o=13*-e,t=1,e>4&&(t=5-e)),S!=gSceneWorld&&S!=gSceneForest&&(t=1),gLayer2.style.setProperty("--shadowSkew",o+"deg"),gLayer2.style.setProperty("--shadowOpacity",.4*t)},Te=e=>{w=Date.now(),W.going=0;var o=_[32]||_[13]||_[40]||_[83]||y==gButGo;if(o&&L&&3!=b&&w-L.talkTime>400&&(ye(),o=0,_=[],gButGo.style.display="none"),1==b)(Z[87]||Z[38])&&(G||(G=-.8)),o&&x&&L!=x&&(gButGo.style.display="none",x.onPress());else if(3==b)(_[27]||y==gButNo)&&(We(),Be(1),gButGo.style.display=gButNo.style.display="none"),o&&(Ke(),gButGo.style.display=gButNo.style.display="none");else if(7==b)Le(-.8),l.scene==S&&(we(l,-.8),R<110&&(l.div.style.transition=l.shadowDiv.style.transition="none",we(l,-.8),Xe(l,gSceneLab),we(l,61-l.x))),R<106&&(Be(8),d.onPress(),i.speech="You have to pick one, there's an invisible wall.");else if(11==b){var t=n;if(t){if(W.mons.splice(W.mons.indexOf(t),1),W.mons.unshift(t),je(),s=t,t.x=1.2,ve(t),t.reload=-5,t.div.style.filter="",n.monKind==gMonKindCure)return Be(19),setTimeout((e=>{if(ne(W.mons.shift()),so(1)>a.hp/a.hpMax){ne(a);var o=ge(a.monKind);de(o,a.hp),Be(18),ue(o,"ü•∞",me)}else ue(W,"Failed! The zombie is too strong!",ce),Be(17)}),500),void(n=0);n=0}s.reload++,s.reload>=s.reloadMax?(Be(14),s.reload=0,s.x++,ve(s),setTimeout((e=>{a.x+=.3,ve(a),ie(s),de(a,a.hp-le(s)),a.hp<=0?(Be(15),setTimeout((e=>{he("ü™¶",a.x,0,53,4),ne(a),me()}),999)):setTimeout((e=>{14==b&&(s.x--,ve(s),a.x-=.3,ve(a),Be(11))}),111)}),111)):(a.reload++,a.reload>=a.reloadMax&&(Be(15),a.reload=0,a.x--,xe(a,.1),ve(a),setTimeout((e=>{s.x-=.3,ve(s),ie(a),de(s,s.hp-le(a)),s.hp<=0?(Be(15),setTimeout((e=>{ce()}),999)):setTimeout((e=>{15==b&&(a.x++,ve(a),s.x+=.3,ve(s),Be(11))}),111)}),111)))}else 8==b?w-re>999&&(Le(1),R>i.x+7&&(Be(9),ue(i,"Gramps! I'm fed up with waiting!",(e=>{ue(l,"Rival? Let me think...",(e=>{ue(l,"Oh that's right I told you to come! Just wait!",(e=>{ue(l,"There are three zombies here. Haha!",(e=>{ue(l,"A heart will cure a zombie, then it will be yours!",(e=>{ge(gMonKindCure),ue(l,"Use this heart "+gMonKindCure.emoji+" on one. Go on, choose!"),Be(1),Le(.01),S.startX=39,gMom.speech="I see you got your first emoji! Tap it to rename it."}))}))}))}))})))):4==b&&W.targetX&&(R>W.targetX?Le(-1):(Le(.1),W.targetX=0));if(N+=G,G+=.08,N>0&&(N=0,G=0),1==b&&((Z[65]||Z[37]||g&&h==gButL)&&Le(-1),(Z[68]||Z[39]||g&&h==gButR)&&Le(1)),W.going0!=W.going)for(var r of(W.going0=W.going,fe(W,W.going),W.mons))fe(r,W.going);A!=N&&(W.div.style.top=N+"rem",A=N,W.shadowDiv.style.transform="translate3d(calc(var(--youX) - var(--cameraX) - 3.5rem),calc("+(W.y+53)+"rem - 100%),"+(W.z-N/2)+"rem)"),E+=.01,~~(E%=24)!=O&&(gClock.innerHTML="&#"+(128336+~~(E-1)%12)+";",O=~~E,Me(),ke()),scrollTo(0,0),_=[],U=[],y=0},ke=e=>{if(S!=gSceneWorld&&S!=gSceneForest)return gLayer1.style.background="#DDD",void(gLayer2.style.filter=gGround.style.filter="brightness(1)");var o=E/24*J*2+1.5*J;gSun.div.style.left=(Math.cos(o)+1)/2*100+"%",gSun.div.style.top=44*(1-Math.sin(o))-10+"rem",o+=J,gMoon.div.style.left=(Math.cos(o)+1)/2*100+"%",gMoon.div.style.top=44*(1-Math.sin(o))-10+"rem";var t=1;if(E>5&&E<9||E>16&&E<19){var r=E<9?(E-5)/4:1-(E-16)/3;gLayer1.style.background="linear-gradient(rgb("+(200-60*r)+",204,"+(222+33*r)+") "+(14+10*r)+"rem, rgb(255,"+(70+180*r)+","+(20+230*r)+") 54rem)",t=1-.4*(1-r**2)}else if(E<=5||E>=19){r=0;E<=5&&E>3&&(r=(E-3)/2),E>=19&&E<21&&(r=1-(E-19)/2),gLayer1.style.background="linear-gradient(rgb("+(10+190*r)+","+(24+180*r)+","+(42+180*r)+") "+(24-10*r)+"rem, rgb("+(65+190*r)+","+(110-40*r)+","+(150-130*r)+") 54rem)",t=.6}else gLayer1.style.background="linear-gradient(#9cf 24rem, #FFF 54rem)";gLayer2.style.filter=gGround.style.filter=`brightness(${t})`},Ce=e=>{gGoldDiv.innerHTML=o=e},Be=e=>{console.log("gStateSet from",b,"to",e),b=e,re=w},Xe=(e,o)=>{var t=[e.div,e.shadowDiv];for(var r of(e.scene=o,t))r&&(r.classList.remove("obj"+S.i),r.classList.add("obj"+o.i))},De=e=>{var o=[...W.mons,W];for(var t of o)Xe(t,e);var r=S;if(S&&(S.youX=R),R=11,S!=gSceneWorld)for(var t of ae)t.scene==e&&t.sceneGo==S&&(R=t.x+t.sizeY/2);S=e,W.div.style.transition="none",W.div.style.translate="none",gGround.style.background=e.bgColor,gLayer1.style.height=(e!=gSceneWorld&&e!=gSceneForest?70:44)+"rem",I.body.className="scene"+e.i,Be(te),Le(.1),ke(),Me(),ho(S.song,2),r&&qe()},$e=e=>{gLayer2.style.perspective=(F=e)+"rem"},ze=e=>{P=e,/^((?!chrome|android).)*safari/i.test(navigator.userAgent)&&(e-=50),gLayer2.style.perspectiveOrigin=`center ${e}rem`},He=[],Ie=e=>{var o={i:He.length+1,bgColor:e,song:lo,cameraY:40,cameraZ:80,grass:[]};return He.push(o),S=o},Ke=0,We=0,Ye=(e,o)=>{Be(3),gButGo.style.display=gButNo.style.display="block",Ke=e,We=o},Pe=e=>{for(var o of se)if(o.emoji==e)return o},Fe=e=>{p&&be(p,"sel"),(p=e)&&be(e,"sel",1)},Re=e=>{v&&(r||ue(v,v.monKind.name+`<br>‚ù§${v.hp}/${v.hpMax} üó°${v.monKind.pow}<br><button onclick="gMonNameSet('${v.monKind.id}')"><p class=nl>N</p> Rename</button>`),v.div.style.filter="unset",pe(v,W.z),v.y=0,ve(v),v=0,je()),g=0,Fe()},Ge=e=>{if(r=0,g=1,h=y=e.target,Fe(h),(1==b||4==b||a)&&!h?.classList.contains("but"))for(var o of W.mons)if(Ee(o,e.clientX,e.clientY)){a?o!=s&&o.hp&&(n=o,o.div.style.filter="brightness(1.1) contrast(1.2) drop-shadow(0 0 .1rem #0F0)"):(v=o,xe(o,0),o.div.style.filter="brightness(1.1) contrast(1.2) drop-shadow(0 0 .1rem #000)",pe(o,W.z+2),o.y=-2,ve(o));break}if(h==gMuteBut&&Ue(),!go[0]){for(var t=11;t--;)go[t]=new AudioContext;ho(S.song,2),1!=ao("mute")&&Ue()}for(var i of go)"suspended"==i.state&&i.resume();eo.resume()},Ne=e=>{if(r=1,h=I.elementFromPoint(e.clientX,e.clientY),v){ye(),h=0,v.x=Ae(e.clientX,0,v.z)[0]-2-R;for(var o,t,a=W.mons.indexOf(v),s=-1;t=W.mons[++s];)if(s>a&&Oe(v.x)>Oe(t.x)&&(o=s),s<a&&Oe(v.x)<Oe(t.x)){o=s;break}o>=0&&(W.mons.splice(a,1),W.mons.splice(o,0,v),je()),ve(v),e.clientY<oe/3&&W.mons.length>1&&(confirm("Set Free?")&&(W.mons.splice(W.mons.indexOf(v),1),v.kind=3,v.x=R,v.y=0,pe(v,52),ve(v)),Re())}h!=p&&Fe(h)},Ae=(e,o,t)=>{var r=(o-oe/2)/Q*(1-t/F);return r+=oe/Q/4.3-28,r+=-1.5*(P-30)*(oe/Q-100)/150,[Y+ee/2+(e-V/2)/Q*(1-t/F),r+=(P-42)/2]},Ee=(e,o,t)=>{var r=Ae(o,t,e.z);return Oe(r[0]-R-2-e.x)<2&&Oe(r[1]-2-e.y)<3},Oe=Math.abs,Ze=(e,o,t="",r="")=>{for(;e--;)t+=o>1?"üí†":"üî∑";for(;o--;)r+=t+"<br>";return r},_e=-1,Ue=e=>{_e=!_e,gMuteBut.innerHTML=_e?"üîá":"üîä",ro("mute",+_e)},qe=e=>{ro("monIds",W.mons.map((e=>e.monKind.id))),ro("monHps",W.mons.map((e=>e.hp))),ro("x",R),ro("scene",S.i),ro("gold",o),ro("quest",t),ro("hour",E)},Je=nearApi,Qe=e=>{gNearBut.style.textShadow="0 0 5px "+(T.isSignedIn()?"#0f0":"red"),Ve()},Ve=e=>{M.get_all_pets({}).then((e=>{for(var o of e)for(var t of se)t.id==o[0]&&(t.name=o[1])}))},eo=new AudioContext,oo=e=>{for(var o=0,t=0;t<e.length;t+=5)o+=e[t+2];var r=eo.sampleRate,a=Math.round(r*o),s=eo.createBuffer(1,a,r),n=s.getChannelData(0),i=new Float32Array(a),l=0,d=0,m=0,c=2*Math.PI;for(t=0;t<e.length;t+=5){d=r*e[t+3]|0,l-=Math.min(m,d),m=r*e[t+4]|0;for(var g=c*e[t]*10/r,h=c*e[t+1]*10/r,p=r*e[t+2]|0,v=t/5%2?i:n,y=0;y<p;y++){var u=y/p,f=y*(h*u+g*(1-u)),w=Math.sin(f);y<d?w*=y/d:y>p-m&&(w*=(p-y)/m),v[l++]=w}}for(t=0;t<a;t++)n[t]=(n[t]+i[t])/2;return s},to=e=>{if(!_e){var o=eo.createBufferSource();if(!o)return;o.buffer=e;var t=eo.createGain();o.connect(t),t.connect(eo.destination),o.start(0)}},ro=(e,o)=>{localStorage[K+e]=o},ao=e=>localStorage[K+e],so=e=>Math.random()*e,no=e=>{for(var o of W.mons)de(o,o.hpMax);Be(1)};onmousedown=Ge,onmouseup=Re,onmousemove=e=>g&&Ne(e),addEventListener("touchstart",(e=>{q=1;var o=e.changedTouches[0];return o&&Ge(o),gButL.style.display=gButR.style.display="block",e.preventDefault(),!1}),{passive:!1}),addEventListener("touchend",(e=>(Re(),e.preventDefault(),!1)),{passive:!1}),addEventListener("touchmove",(e=>{var o=e.changedTouches[0];return o&&Ne(o),e.preventDefault(),!1}),{passive:!1}),addEventListener("keydown",(e=>{var o=e.keyCode;Z[o]||(_[o]=Z[o]=1)})),addEventListener("keyup",(e=>{var o=e.keyCode;Z[o]=0,U[o]=1})),onresize=e=>{V=innerWidth,oe=innerHeight,Q=Math.min(V,oe)/100,ee=V/Q,W.div&&Le(0)},onload=r=>{for(var a of(Ce(1),B=oo([15,16,.1,.002,.001,15,18,.1,.02,.01]),C=oo([18,26,.1,.04,.04]),X=oo([24,19,.05,.02,.02]),k=oo([17,17,.08,.002,.02,21,21,.08,.002,.02,25,27,.1,.002,.02]),$=oo([25,24,.1,.02,.02,17,17,.1,.02,.02,14,12,.3,.03,.09]),D=oo([25,25,.1,.02,.02,22,22,.1,.02,.02,35,35,.2,.03,.09]),z=oo([15,17,.03,.001,.001,16,16,.03,.001,.001,15,15,.03,.001,.001]),Je.nearInitPromise=(async e=>{let o=await Je.connect({nodeUrl:"https://rpc.testnet.near.org",walletUrl:"https://wallet.testnet.near.org",helperUrl:"https://helper.testnet.near.org",explorerUrl:"https://explorer.testnet.near.org",networkId:"testnet",keyStore:new nearApi.keyStores.BrowserLocalStorageKeyStore(localStorage,K)});e=(T=new Je.WalletConnection(o)).isSignedIn()?T.account():new Je.Account(o.connection,"pets.vertfromage.testnet"),M=new Je.Contract(e,"pets.vertfromage.testnet",{viewMethods:["get_all_pets"],changeMethods:["change_pet_name"]})})().then(Qe),se))if(a.id=a.name,a.reload||=1,a.repel||=1,a.pow.sub){var s=parseInt(a.pow);a.powKind=a.pow.substr(`${s}`.length),a.pow=s}onresize(),H.gSceneWorld=Ie("#583"),H.gSceneHouseYou=Ie("#822"),H.gSceneBedroom=Ie("#822"),H.gSceneHouseRival=Ie("#822"),H.gSceneLab=Ie("#def"),H.gSceneCenter1=Ie("#def"),H.gSceneMart1=Ie("#def"),H.gSceneIntro=Ie("#fff");var n=he("üë®‚Äçü¶º",20,0,53,9,0,0,3,"!"),m=he("üêí",-20,0,48,6,0,0,3);xe(m,.5),H.gSceneForest=Ie("#583"),S.endX=277,he("üßç‚Äç‚ôÇÔ∏è",16,0,53,7,0,.03,3,"The Final Forest. Some say they've seen a dragon in the moonlight."),he("üî∑",0,0,58,6,3,0,0,"",gSceneWorld);var c="üèî";for(p=4;p--;)c+=c;for(he(c,-100,0,20,42,1),u.whiteSpace="nowrap",u.letterSpacing="-15rem",p=0;p<33;p++){var g=36;p<5&&(g+=6),he("üå≤",11*(p+.5+so(.03))-22,0,25+so(15),15+so(2)),he("üå≤",11*(p+so(.03))-22,0,g+so(10),15+so(2)),he("üå≤",33+11*(p+so(.03)),0,64+so(10),15+so(2))}for(p=55;p-- >5;){v=he("<div>üåæ</div>",(b=5*p)+so(3),0,55.5,6),S.grass[b/5|0]=v}gSceneForest.cameraY=30,gSceneForest.cameraZ=100,gSceneWorld.cameraY=30,gSceneWorld.cameraZ=100,(S=gSceneWorld).endX=531,S.song=[6,0,9,0,12,0,9,0,14,0,9,0,16,0,9,0,14,0,9,0,14,0,9,0,14,0,16,0,18,0,16,0,14,0,12,0,14,0,9,0,16,0,9,0,14,0,9,0,18,0,9,0,14,0,9,0,18,19,18,0,16,0,9,0,14,0,9,0,18,19,18,0,21,0,9,0,18,0,9,0,16,0,9,0,18,0,16,0,14,0,9];for(var h=20;h--;)H.gStar=he("&bull;",so(ee),so(30),0,1.5,1),u.color="#9cf";H.gSun=he("<div style='transform:translateX(-50%)'>üåû</div>",0,0,0,20,1),u.textShadow="0 0 2rem #FA4",u.transition="all 1s ease",H.gMoon=he("<div style='transform:translateX(-50%)'>üåï</div>",0,0,0,15,1),u.textShadow="0 0 2rem #FFF",u.transition="all 1s ease",he(Ze(23,1),-11,0,58,6,3),u.filter="grayscale(.9) brightness(1.3)";var p=-122;for(g=20;p<533;){var v=he("üèî",p,0,g,42,1);so(.2),so(.2);(p+=so(16)+22)>-50&&g>4&&(g-=4,p-=15)}for(he("üå≤",35,0,40,16),he("üå≤",40,0,30,16),he("üå≤",60,0,40,16),p=0;p<23;p++){g=36;p<5&&(g+=6),he("üå≤",122+11*(p+.5+so(.03)),0,25+so(15),18+so(2)),he("üå≤",122+11*(p+so(.03)),0,g+so(10),18+so(2))}for(var y=0;y<4;y++){var w=4;for(0==y&&(w=6),1==y&&(w=2),p=0;p<w;p++){var b=66*y+5*p+145,x=-2;0==y&&(x=0);for(g=x;g<=2;g++)v=he("<div>üåæ</div>",b+so(3),0,55.5+5*g,6),0==g&&(S.grass[b/5|0]=v)}}for(p=0;p<2;p++)for(g=0;g<2;g++)he("üåºüåºüåºüåº",71*p-10,0,47+3*g,3);he("",-194,0,71,70,3),S.startX=-42,u.width="150rem",u.background="#69D",he("üè°",3,0,50,27,0,.2,0,"",gSceneHouseYou),he("üì´",3,0,50,5),he("ü™ß",184,0,53,6,0,.07,0,"Route 1:<br>To Green-Blue City"),he("ü™ß",75,0,52,6,0,.07,0,"Color Palette Town:<br>Shades of your journey are belong to us!"),he("üè†",34,0,50,27,0,.2,0,"",gSceneHouseRival),d=he("üè¢",87,-1,50,38,0,0,0,"",gSceneLab),(W=he("üö∂",0,0,55,7,0,.04,1)).shadowDiv.className="shadow0",W.mons=[],he("üè•",400,0,50,30,0,.2,0,"",gSceneCenter1),he("üè™",436,0,50,30,0,.2,0,"",gSceneMart1),he("üöõ",468,0,50,15,0,.2);var j=he("üèØ",485,0,50,33,0,.1,""," ");for(j.onPress=e=>{ue(W,"The door is locked."),Le(-1)},j.onLeave=ye,he("üå≥",525,0,50,20,0,.2,0,"",gSceneForest),he("ü™ß",380,0,53,6,0,.07,0,"Green-Blue City: The Eternally Greenish Blue Paradise"),he(Ze(23,1),380,0,58,6,3),S=gSceneLab,he(Ze(18,3),9,0,51,6,3),u.opacity=.5,he("üö™",0,0,54,11,0,0,0,"",gSceneWorld),he("üóÑ",17.1,0,53,6,0,.03),he("üë®‚Äçüî¨",22,-5.7,52.5,3.5,1,0,3,"I study emojis as professor X's AIDE."),he("üóÑ",21.1,0,53,6,0,.03),he("üóÑ",25.1,0,53,6,0,.03),he("üë©‚Äçüî¨",30,-5.7,52.5,3.5,1,0,3,"Professor X is the authority on emoji. Many emoji trainers hold him in high regard."),he("üóÑ",29.1,0,53,6,0,.03),he("üóÑ",33.1,0,53,6,0,.03),he("üìä",110,-6,45,6,2),he("üì†",114,-6,55,3.5,1),he("üóÑ",S.endX=112.9,0,54,6,0,.03),h=8;h--;)he("ü™ü",9+12*h,-7,45,12,2);i=he("üßç‚Äç‚ôÇÔ∏è",52,0,53,7,0,.03,3,"Yo! Gramps isn't around!"),l=he("üë®‚Äçü¶º",999,0,53,9,0,0,3,"Which emoji do you want?");h=0;var L=["üê°","ü¶£","üêì"].map(Pe);for(var Y of L){p=73+7.5*h;var P=he(Y.emoji,p,.4,52.5,4,0,.05,3,"Brains?");P.div.classList.add("zombie"),P.monKind=Y,function(e){e.onPress=o=>{l.x>888||W.mons[0].monKind!=gMonKindCure?ue(e):(ue(l,"You want the "+e.monKind.types.join("/")+` emoji, ${e.monKind.name}?`),Ye((o=>{Be(4),e.cage.div.style.opacity=e.cage.shadowDiv.style.opacity=0,setTimeout((o=>{ne(W.mons[0]),W.mons=[],ne(e),ge(e.monKind),setTimeout((e=>ue(W.mons[0],"üòç")),111),setTimeout((e=>{ye(),Be(1),l.speech="To save every type of emoji in the world... That was my dream!",i.speech="Alright gramps! Leave it all to me!",S.startX=0}),999)}),333)}),ye))}}(P),P.cage=he("üåê",p-1.6,0,53,6.5,0,.04),f.transition=u.transition="opacity 1s ease",u.opacity=.7,h++}S=gSceneHouseRival,he("üö™",0,0,50,11,0,0,0,"",gSceneWorld),he("üßò",38,0,53,4.5,0,.02,3,"Hi! Rival is out at grandpa's lab."),he("üî≤",35,0,57,11,3),he("ü™ë",33,0,51,5),he("ü´ï",45,0,52,4),he("üóæ",15,-8,45,8,2),he("üß≠",30,-8,45,8,2),he("üåé",45,-8,45,8,2),he("üì∫",1+(S.endX=55),0,55,5),S=gSceneBedroom,he("ü™ü",1,-7,45,12,2),(j=he("üõè",1,0,50,11,0,0,0,"!")).onPress=e=>{W.mons.length||ue(W,"I've slept enough!"),no()},he("‚òÆ",20,-8,45,8,2),he("üåâ",30,-8,45,8,2);var F=he("üì∫",20,0,47,6,0,0,0,"!");F.onPress=e=>{ue(F,"Dragon Warrior II",(e=>{ue(W,"Would be cool if you could catch any monster and add it to your party.")}))},he("üéÆ",21,0,51,3),he("üï≥",45,2,54.5,5,1),he("ü™ú",45,0,54.6,5,0,0,0,"",gSceneHouseYou),S.endX=50,S=gSceneHouseYou,he("üßª",89,-3.5,52,2.4,1),he("üöΩ",S.endX=88,0,53,6),H.gMom=he("üßç",41,0,53,8,0,0,3,"Right!<br>All boys leave home some day."),he("üì∫",48,0,50,5,0,0,0,"There's a movie on TV. Four boys are walking on railroad tracks."),j=he("ü™úü™úü™ú",S.youX=75,-8,46,5,2,0,0,"",gSceneBedroom),f.width=u.width=u.height,f.lineHeight=u.lineHeight=.9,he("üõã",32,0,50,12),he("üñº",22,-10,45,6,2),he("üñº",32,-10,45,6,2),he("ü™ü",62,-7,45,8,2),he("üö™",0,0,50,11,0,0,0,"",gSceneWorld),he("ü™¥",13,0,50,5),S=gSceneCenter1,he("üö™",0,0,50,11,0,0,0,"",gSceneWorld),he("ü™¥",13,0,50,5),he("ü™¥",19,0,50,5),he("ü™ë",25,0,51,5),he("ü™ë",30,0,51,5),he("üßò",30,0,51.1,5,0,-.35,3,"Emoji Centers heal your emojis."),he("üóÑ",(p=54)-8-.9,0,53,6,0,.03),he("üóÑ",p-4-.9,0,53,6,0,.03);var G=he("üë©‚Äç‚öïÔ∏è",p,-5.7,52,3.5,1,0,3,"!");for(G.onPress=e=>{Be(12),ue(G,"Welcome to our Emoji Center!",(e=>{ue(G,"Heal your emojis back to perfect health?"),Ye((e=>{no(),ue(G,"Healed! We hope to see you again.")}),(e=>{ye(),Be(1)}))}))},he("üóÑ",p-.9,0,53,6,0,.03),he("üóÑ",p+4-.9,0,53,6,0,.03),he("üóÑ",p+8-.9,0,53,6,0,.03),he("üíª",75,0,53,6),h=4;h--;)he("ü™ü",9+18*h,-7,45,12,2);he(Ze(12,3),9,0,51,6,3),he("üßç‚Äç‚ôÇÔ∏è",70,0,53,7,0,.03,3,"No need for the computer. To drop an emoji, just swipe it upwards!"),S.endX=77,S=gSceneMart1,he("üö™",0,0,50,11,0,0,0,"",gSceneWorld),he("üßæ",40,-6,45,3,2);var N=he("üë®‚Äçüíº",p=30,-5.5,51,3.5,1,0,3,"!");N.onPress=o=>{t?ue(N,"That's all I have?"):(Be(13),ue(N,"Hey! You came from Color Palette Town?",(o=>{ue(N,"You know professor X right? His order came in. Will you take it to him?"),Ye((o=>{t=1,l.speech="My package! Too bad the emojidex doesn't fit into 13KB.",Be(1),ue(N,e.emoji),ge(e)}),(e=>{ue(N,"You're not supposed to say no! Get out of my shop!"),Be(1)}))})))};for(var A=3;A--;)for(g=3;g--;)he("üì¶",p+1.8*g,-2-.8*g+1.6*A,53-g-.1*A,4,1),g>0&&he("üì¶",p-1.4*g,-2-.8*g+1.6*A,53-g-.1*A,4,1);for(he(gMonKindCure.emoji,p-10+.2,0,50.5,4,0,0,3,"!").onPress=e=>{ue(N,"Buy for 1 coin?"),Ye((e=>{o>0&&(Ce(o-1),ge(gMonKindCure)),ye(),Be(1)}),(e=>{ye(),Be(1)}))},h=3;h--;)he("ü™ü",9+18*h,-7,45,12,2);if(he(Ze(8,3),9,0,51,6,3),u.filter="hue-rotate(133deg)",S.endX=55,S=0,ao("scene")){t=1*ao("gQuest"),E=1*ao("gHour")||0;var O=ao("monIds").split(","),Z=ao("monHps").split(",");h=0;for(var _ of O)for(var U of se)U.id==_&&de(ge(U),1*Z[h++]);Ce(1*ao("gold"));var q=He[ao("scene")-1];ze(q.cameraY),$e(q.cameraZ),De(q),R=1*ao("x"),Le(0)}else ze(gSceneIntro.cameraY),$e(gSceneIntro.cameraZ),De(gSceneIntro),gButR.style.display=gButL.style.display="none",Be(0),setTimeout((e=>{ue(n,`Welcome to the ${K}!`,(e=>{ue(n,"My name is X, people call me the Emoji Professor!",(e=>{m.x=17,ve(m),ue(n,"This world is inhabited by creatures called emojis!",(e=>{ue(n,"Most of them are zombies. But we have a cure!",(e=>{ue(n,"Turns out you need to smack them with a non-zombie emoji, then throw a heart.",(e=>{ue(n,"A world of dreams and adventures with emojis awaits! Lets go!",(e=>{I.body.style.filter="brightness(0)",setTimeout((e=>{I.body.style.filter="brightness(1)",gButR.style.display=gButL.style.display="block",De(gSceneBedroom)}),999)}))}))}))}))}))}))}),888);setInterval(Te,33)};var io,lo=[5,,,,6,,,,8,,,,9,,,,10,,9,,10,,1,1,8,,6,,8,,1,1,6,,5,,6,,5,,6,,8,,10,,,],mo=[5,5,11,,6,6,11,,7,7,11,,8,8,11,,8,3,11,3,7,3,11,3,6,3,11],co=0,go=(setInterval((e=>{io&&!_e&&(co>=io.length?co=0:(po(co),co++))}),200),[]),ho=(e,o)=>{if(go[0]){io=[];for(var t=0;t<e.length;t++)e[t]?(io.push(go[t%10].createBuffer(1,1e6,44100)),io[t].getChannelData(0).set(vo(e[t],o))):io.push(0)}},po=e=>{if(io[e]){var o=e%10,t=go[o].createBufferSource();t.buffer=io[e],t.connect(go[o].destination),t.start()}},vo=(e,o)=>{e=130.81*1.06**e;for(var t=o,r=(e,o,t,r)=>Math.sin(e/o*6.28*t+r),a=(e,o)=>.1*Math.sin(e/44100*o*6.28+r(e,44100,o,0)**2+.75*r(e,44100,o,.25)+.1*r(e,44100,o,.5)),s=[],n=0;n<44100*t;n++)s[n]=n<88?n/88.2*a(n,e):(1-(n-88.2)/(44100*(t-.002)))**((.5*Math.log(1e4*e/44100))**2)*a(n,e);return s};